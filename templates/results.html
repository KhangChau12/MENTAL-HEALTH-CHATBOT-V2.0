{% extends "base.html" %}

{% block title %}Results - Mental Health Assessment{% endblock %}

{% block additional_css %}
<style>
.results-container {
    min-height: 100vh;
    background: var(--color-background);
    padding: 2rem 0;
}

.results-header {
    text-align: center;
    margin-bottom: 3rem;
    padding: 0 2rem;
}

.results-icon {
    width: 80px;
    height: 80px;
    margin: 0 auto 1.5rem;
    background: var(--color-success-light);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
}

.results-title {
    font-size: 2rem;
    font-weight: 700;
    color: var(--color-text);
    margin-bottom: 0.5rem;
}

.results-subtitle {
    color: var(--color-text-muted);
    font-size: 1rem;
    max-width: 600px;
    margin: 0 auto;
    line-height: 1.6;
}

.results-content {
    max-width: 1000px;
    margin: 0 auto;
    padding: 0 2rem;
}

.results-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2rem;
    margin-bottom: 3rem;
}

.result-card {
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: 1rem;
    padding: 2rem;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    animation: fadeInUp 0.4s ease;
}

.result-card.featured {
    grid-column: 1 / -1;
    background: linear-gradient(135deg, var(--color-primary-light), var(--color-accent-light));
    border: 2px solid var(--color-primary);
}

.result-header {
    display: flex;
    align-items: center;
    justify-content: between;
    margin-bottom: 1.5rem;
}

.result-type {
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--color-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.result-score {
    font-size: 2rem;
    font-weight: 700;
    color: var(--color-primary);
    margin-left: auto;
}

.result-title {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--color-text);
    margin-bottom: 0.5rem;
}

.result-severity {
    display: inline-block;
    padding: 0.5rem 1rem;
    border-radius: 2rem;
    font-size: 0.875rem;
    font-weight: 600;
    margin-bottom: 1rem;
}

.severity-minimal {
    background: var(--color-success-light);
    color: var(--color-success);
}

.severity-mild {
    background: var(--color-warning-light);
    color: var(--color-warning);
}

.severity-moderate {
    background: var(--color-error-light);
    color: var(--color-error);
}

.severity-severe {
    background: var(--color-error);
    color: white;
}

.result-description {
    color: var(--color-text-muted);
    line-height: 1.6;
    margin-bottom: 1.5rem;
}

.result-details {
    background: var(--color-background);
    border-radius: 0.5rem;
    padding: 1rem;
    margin-top: 1rem;
}

.result-breakdown {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 1rem;
    margin-top: 1rem;
}

.breakdown-item {
    text-align: center;
    padding: 1rem;
    background: var(--color-surface);
    border-radius: 0.5rem;
    border: 1px solid var(--color-border);
}

.breakdown-value {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--color-primary);
    display: block;
}

.breakdown-label {
    font-size: 0.75rem;
    color: var(--color-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-top: 0.25rem;
}

.recommendations-section {
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: 1rem;
    padding: 2rem;
    margin-bottom: 2rem;
}

.recommendations-title {
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--color-text);
    margin-bottom: 1.5rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.recommendations-list {
    display: grid;
    gap: 1rem;
}

.recommendation-item {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    padding: 1.5rem;
    background: var(--color-background);
    border: 1px solid var(--color-border);
    border-radius: 0.75rem;
    transition: all 0.2s ease;
}

.recommendation-item:hover {
    border-color: var(--color-primary-light);
    transform: translateY(-1px);
}

.recommendation-icon {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: var(--color-primary-light);
    color: var(--color-primary);
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.recommendation-content {
    flex: 1;
}

.recommendation-title {
    font-size: 1rem;
    font-weight: 600;
    color: var(--color-text);
    margin-bottom: 0.5rem;
}

.recommendation-description {
    color: var(--color-text-muted);
    font-size: 0.875rem;
    line-height: 1.5;
}

.resources-section {
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: 1rem;
    padding: 2rem;
    margin-bottom: 2rem;
}

.resources-title {
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--color-text);
    margin-bottom: 1.5rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.resources-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1rem;
}

.resource-card {
    padding: 1.5rem;
    background: var(--color-background);
    border: 1px solid var(--color-border);
    border-radius: 0.75rem;
    transition: all 0.2s ease;
}

.resource-card:hover {
    border-color: var(--color-primary-light);
    transform: translateY(-1px);
}

.resource-title {
    font-size: 1rem;
    font-weight: 600;
    color: var(--color-text);
    margin-bottom: 0.5rem;
}

.resource-description {
    color: var(--color-text-muted);
    font-size: 0.875rem;
    line-height: 1.5;
    margin-bottom: 1rem;
}

.resource-contact {
    font-size: 0.875rem;
    color: var(--color-primary);
    font-weight: 500;
}

.actions-section {
    display: flex;
    gap: 1rem;
    justify-content: center;
    flex-wrap: wrap;
    margin-top: 3rem;
}

.action-button {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.875rem 2rem;
    border: 2px solid var(--color-border);
    border-radius: 0.75rem;
    background: transparent;
    color: var(--color-text);
    text-decoration: none;
    cursor: pointer;
    transition: all 0.2s ease;
    font-weight: 600;
    font-size: 0.875rem;
}

.action-button:hover {
    border-color: var(--color-primary);
    color: var(--color-primary);
    transform: translateY(-1px);
}

.action-button.primary {
    background: var(--color-primary);
    border-color: var(--color-primary);
    color: white;
}

.action-button.primary:hover {
    background: var(--color-primary-dark);
    border-color: var(--color-primary-dark);
    color: white;
}

.disclaimer {
    background: var(--color-warning-light);
    border: 1px solid var(--color-warning);
    border-radius: 0.75rem;
    padding: 1.5rem;
    margin-top: 2rem;
    text-align: center;
}

.disclaimer-icon {
    width: 40px;
    height: 40px;
    margin: 0 auto 1rem;
    background: var(--color-warning);
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
}

.disclaimer-title {
    font-size: 1rem;
    font-weight: 600;
    color: var(--color-warning);
    margin-bottom: 0.5rem;
}

.disclaimer-text {
    color: var(--color-text-muted);
    font-size: 0.875rem;
    line-height: 1.5;
}

/* Progress Circle */
.progress-circle {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 1rem;
}

.progress-circle::before {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: 50%;
    padding: 4px;
    background: conic-gradient(var(--color-primary) calc(var(--percentage) * 1%), var(--color-muted) 0);
    mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    mask-composite: xor;
    -webkit-mask-composite: xor;
}

.progress-circle-content {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--color-primary);
    text-align: center;
}

/* Animations */
@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Responsive Design */
@media (max-width: 768px) {
    .results-container {
        padding: 1rem 0;
    }
    
    .results-header {
        margin-bottom: 2rem;
    }
    
    .results-title {
        font-size: 1.5rem;
    }
    
    .results-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
    }
    
    .result-card {
        padding: 1.5rem;
    }
    
    .result-breakdown {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .resources-grid {
        grid-template-columns: 1fr;
    }
    
    .actions-section {
        flex-direction: column;
        align-items: stretch;
    }
    
    .action-button {
        justify-content: center;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="results-container">
    <!-- Results Header -->
    <div class="results-header">
        <div class="results-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                <polyline points="22,4 12,14.01 9,11.01"/>
            </svg>
        </div>
        
        <h1 class="results-title">Kết quả đánh giá sức khỏe tâm thần</h1>
        <p class="results-subtitle">
            Dưới đây là kết quả chi tiết từ bài đánh giá của bạn. Vui lòng đọc kỹ và tham khảo các đề xuất được cung cấp.
        </p>
    </div>
    
    <!-- Results Content -->
    <div class="results-content">
        <!-- Overall Results -->
        <div class="results-grid">
            <!-- Featured Overall Result -->
            <div class="result-card featured">
                <div class="result-header">
                    <div>
                        <div class="result-type">Kết quả tổng quan</div>
                        <h2 class="result-title">Đánh giá tổng thể</h2>
                    </div>
                    <div class="progress-circle" style="--percentage: 35">
                        <div class="progress-circle-content">
                            <div id="overall-score">25</div>
                            <div style="font-size: 0.75rem; color: var(--color-text-muted);">điểm</div>
                        </div>
                    </div>
                </div>
                
                <div class="result-severity severity-mild" id="overall-severity">
                    Mức độ nhẹ
                </div>
                
                <p class="result-description" id="overall-description">
                    Kết quả cho thấy bạn có một số dấu hiệu cần chú ý về sức khỏe tâm thần. Đây là mức độ có thể được cải thiện thông qua các biện pháp tự chăm sóc và hỗ trợ phù hợp.
                </p>
                
                <div class="result-breakdown">
                    <div class="breakdown-item">
                        <span class="breakdown-value" id="depression-score">8</span>
                        <span class="breakdown-label">Trầm cảm</span>
                    </div>
                    <div class="breakdown-item">
                        <span class="breakdown-value" id="anxiety-score">12</span>
                        <span class="breakdown-label">Lo âu</span>
                    </div>
                    <div class="breakdown-item">
                        <span class="breakdown-value" id="stress-score">16</span>
                        <span class="breakdown-label">Căng thẳng</span>
                    </div>
                    <div class="breakdown-item">
                        <span class="breakdown-value" id="risk-level">Thấp</span>
                        <span class="breakdown-label">Mức rủi ro</span>
                    </div>
                </div>
            </div>
            
            <!-- Individual Assessment Results -->
            <div class="result-card">
                <div class="result-header">
                    <div class="result-type">PHQ-9</div>
                    <div class="result-score" id="phq9-score">8</div>
                </div>
                <h3 class="result-title">Đánh giá trầm cảm</h3>
                <div class="result-severity severity-mild">Mức độ nhẹ</div>
                <p class="result-description">
                    Có một số triệu chứng trầm cảm nhẹ. Nên theo dõi và áp dụng các phương pháp tự chăm sóc.
                </p>
            </div>
            
            <div class="result-card">
                <div class="result-header">
                    <div class="result-type">GAD-7</div>
                    <div class="result-score" id="gad7-score">12</div>
                </div>
                <h3 class="result-title">Đánh giá lo âu</h3>
                <div class="result-severity severity-moderate">Mức độ vừa phải</div>
                <p class="result-description">
                    Có dấu hiệu lo âu ở mức độ vừa phải. Nên cân nhắc tìm kiếm hỗ trợ chuyên nghiệp.
                </p>
            </div>
            
            <div class="result-card">
                <div class="result-header">
                    <div class="result-type">DASS-21</div>
                    <div class="result-score" id="dass21-score">16</div>
                </div>
                <h3 class="result-title">Đánh giá căng thẳng</h3>
                <div class="result-severity severity-mild">Mức độ nhẹ</div>
                <p class="result-description">
                    Mức căng thẳng ở ngưỡng nhẹ. Có thể cải thiện thông qua quản lý stress và thư giãn.
                </p>
            </div>
        </div>
        
        <!-- Recommendations Section -->
        <div class="recommendations-section">
            <h2 class="recommendations-title">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M9 12l2 2 4-4"/>
                    <path d="M21 12c.552 0 1-.448 1-1V8c0-.552-.448-1-1-1s-1 .448-1 1v3c0 .552.448 1 1 1z"/>
                    <path d="M3 12c-.552 0-1-.448-1-1V8c0-.552.448-1 1-1s1 .448 1 1v3c0-.552-.448-1-1-1z"/>
                </svg>
                Đề xuất cho bạn
            </h2>
            
            <div class="recommendations-list" id="recommendations-list">
                <div class="recommendation-item">
                    <div class="recommendation-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
                        </svg>
                    </div>
                    <div class="recommendation-content">
                        <h4 class="recommendation-title">Thực hành thiền và thư giãn</h4>
                        <p class="recommendation-description">
                            Dành 10-15 phút mỗi ngày để thiền hoặc thực hành hơi thở sâu. Điều này có thể giúp giảm căng thẳng và cải thiện tâm trạng.
                        </p>
                    </div>
                </div>
                
                <div class="recommendation-item">
                    <div class="recommendation-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/>
                        </svg>
                    </div>
                    <div class="recommendation-content">
                        <h4 class="recommendation-title">Tập thể dục đều đặn</h4>
                        <p class="recommendation-description">
                            Hoạt động thể chất nhẹ nhàng như đi bộ, yoga hoặc bơi lội có thể giúp cải thiện tâm trạng và giảm lo âu.
                        </p>
                    </div>
                </div>
                
                <div class="recommendation-item">
                    <div class="recommendation-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                            <circle cx="9" cy="7" r="4"/>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                        </svg>
                    </div>
                    <div class="recommendation-content">
                        <h4 class="recommendation-title">Kết nối xã hội</h4>
                        <p class="recommendation-description">
                            Duy trì liên lạc với bạn bè và gia đình. Chia sẻ cảm xúc với những người bạn tin tưởng.
                        </p>
                    </div>
                </div>
                
                <div class="recommendation-item">
                    <div class="recommendation-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M14 9V5a3 3 0 0 0-6 0v4"/>
                            <rect x="2" y="9" width="20" height="11" rx="2" ry="2"/>
                            <circle cx="12" cy="15" r="1"/>
                        </svg>
                    </div>
                    <div class="recommendation-content">
                        <h4 class="recommendation-title">Tham khảo chuyên gia</h4>
                        <p class="recommendation-description">
                            Nếu các triệu chứng kéo dài hoặc ảnh hưởng đến cuộc sống hàng ngày, hãy tham khảo ý kiến của chuyên gia sức khỏe tâm thần.
                        </p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Resources Section -->
        <div class="resources-section">
            <h2 class="resources-title">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                    <polyline points="14,2 14,8 20,8"/>
                    <line x1="16" y1="13" x2="8" y2="13"/>
                    <line x1="16" y1="17" x2="8" y2="17"/>
                    <polyline points="10,9 9,9 8,9"/>
                </svg>
                Tài nguyên hỗ trợ
            </h2>
            
            <div class="resources-grid">
                <div class="resource-card">
                    <h4 class="resource-title">Đường dây nóng tâm lý</h4>
                    <p class="resource-description">
                        Hỗ trợ tâm lý miễn phí 24/7 cho những ai cần trò chuyện và tư vấn tức thì.
                    </p>
                    <div class="resource-contact">📞 1800-1060</div>
                </div>
                
                <div class="resource-card">
                    <h4 class="resource-title">Trung tâm Sức khỏe Tâm thần Quốc gia</h4>
                    <p class="resource-description">
                        Cung cấp dịch vụ tư vấn và điều trị chuyên nghiệp với đội ngũ bác sĩ có kinh nghiệm.
                    </p>
                    <div class="resource-contact">🌐 www.nimh.org.vn</div>
                </div>
                
                <div class="resource-card">
                    <h4 class="resource-title">Ứng dụng thiền Headspace</h4>
                    <p class="resource-description">
                        Ứng dụng hướng dẫn thiền và thư giãn với nhiều bài tập phù hợp cho người mới bắt đầu.
                    </p>
                    <div class="resource-contact">📱 App Store / Google Play</div>
                </div>
                
                <div class="resource-card">
                    <h4 class="resource-title">Diễn đàn hỗ trợ tâm lý</h4>
                    <p class="resource-description">
                        Cộng đồng chia sẻ kinh nghiệm và hỗ trợ lẫn nhau trong quá trình chăm sóc sức khỏe tâm thần.
                    </p>
                    <div class="resource-contact">🌐 forum.tamly.vn</div>
                </div>
            </div>
        </div>
        
        <!-- Action Buttons -->
        <div class="actions-section">
            <button class="action-button primary" onclick="exportResults('pdf')">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                    <polyline points="14,2 14,8 20,8"/>
                    <line x1="16" y1="13" x2="8" y2="13"/>
                    <line x1="16" y1="17" x2="8" y2="17"/>
                </svg>
                Xuất kết quả PDF
            </button>
            
            <button class="action-button" onclick="exportResults('json')">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                    <polyline points="14,2 14,8 20,8"/>
                </svg>
                Xuất dữ liệu JSON
            </button>
            
            <a href="/assessment" class="action-button">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                    <path d="M3 3v5h5"/>
                    <path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/>
                    <path d="M16 16h5v5"/>
                </svg>
                Đánh giá lại
            </a>
            
            <a href="/" class="action-button">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                    <polyline points="9,22 9,12 15,12 15,22"/>
                </svg>
                Về trang chủ
            </a>
        </div>
        
        <!-- Disclaimer -->
        <div class="disclaimer">
            <div class="disclaimer-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/>
                    <line x1="12" y1="9" x2="12" y2="13"/>
                    <line x1="12" y1="17" x2="12.01" y2="17"/>
                </svg>
            </div>
            <h4 class="disclaimer-title">Lưu ý quan trọng</h4>
            <p class="disclaimer-text">
                Kết quả này chỉ mang tính chất tham khảo và không thay thế cho việc chẩn đoán hoặc tư vấn y tế chuyên nghiệp. 
                Nếu bạn có những lo ngại về sức khỏe tâm thần, hãy tham khảo ý kiến của bác sĩ hoặc chuyên gia sức khỏe tâm thần có trình độ.
            </p>
        </div>
    </div>
</div>
{% endblock %}

{% block additional_js %}
<script>
// Load results data when page loads
document.addEventListener('DOMContentLoaded', function() {
    loadResultsData();
});

function loadResultsData() {
    // Load results from localStorage or API
    const resultsData = localStorage.getItem('assessmentResults');
    if (resultsData) {
        const results = JSON.parse(resultsData);
        updateResultsDisplay(results);
    } else {
        // Fetch from API if needed
        fetchResultsFromAPI();
    }
}

function updateResultsDisplay(results) {
    // Update overall score and severity
    if (results.overall) {
        document.getElementById('overall-score').textContent = results.overall.score || 25;
        document.getElementById('overall-severity').textContent = results.overall.severity || 'Mức độ nhẹ';
        document.getElementById('overall-description').textContent = results.overall.description || 'Kết quả tổng quan';
    }
    
    // Update individual scores
    if (results.phq9) {
        document.getElementById('phq9-score').textContent = results.phq9.score || 8;
        document.getElementById('depression-score').textContent = results.phq9.score || 8;
    }
    
    if (results.gad7) {
        document.getElementById('gad7-score').textContent = results.gad7.score || 12;
        document.getElementById('anxiety-score').textContent = results.gad7.score || 12;
    }
    
    if (results.dass21) {
        document.getElementById('dass21-score').textContent = results.dass21.score || 16;
        document.getElementById('stress-score').textContent = results.dass21.score || 16;
    }
    
    if (results.risk) {
        document.getElementById('risk-level').textContent = results.risk.level || 'Thấp';
    }
    
    // Update progress circle
    const overallScore = results.overall?.score || 25;
    const maxScore = 63; // PHQ-9 (27) + GAD-7 (21) + DASS-21 (15)
    const percentage = Math.round((overallScore / maxScore) * 100);
    document.querySelector('.progress-circle').style.setProperty('--percentage', percentage);
}

function fetchResultsFromAPI() {
    // Fetch results from API endpoint
    fetch('/api/assessment/results')
        .then(response => response.json())
        .then(data => {
            updateResultsDisplay(data);
        })
        .catch(error => {
            console.error('Error fetching results:', error);
            // Use default demo data
            updateResultsDisplay({
                overall: { score: 25, severity: 'Mức độ nhẹ' },
                phq9: { score: 8 },
                gad7: { score: 12 },
                dass21: { score: 16 },
                risk: { level: 'Thấp' }
            });
        });
}

function exportResults(format) {
    const resultsData = localStorage.getItem('assessmentResults');
    
    if (format === 'pdf') {
        // Export as PDF
        fetch('/api/export/pdf', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: resultsData || JSON.stringify({})
        })
        .then(response => response.blob())
        .then(blob => {
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.style.display = 'none';
            a.href = url;
            a.download = 'ket-qua-danh-gia-suc-khoe-tam-than.pdf';
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
        })
        .catch(error => {
            console.error('Error exporting PDF:', error);
            showToast('error', 'Có lỗi khi xuất file PDF');
        });
    } else if (format === 'json') {
        // Export as JSON
        const dataStr = resultsData || JSON.stringify({}, null, 2);
        const dataBlob = new Blob([dataStr], {type: 'application/json'});
        const url = window.URL.createObjectURL(dataBlob);
        const a = document.createElement('a');
        a.style.display = 'none';
        a.href = url;
        a.download = 'assessment-results.json';
        document.body.appendChild(a);
        a.click();
        window.URL.revokeObjectURL(url);
    }
}

function showToast(type, message) {
    // Simple toast notification
    const toast = document.createElement('div');
    toast.className = `toast toast-${type}`;
    toast.textContent = message;
    toast.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 1rem 1.5rem;
        background: var(--color-${type === 'error' ? 'error' : 'success'});
        color: white;
        border-radius: 0.5rem;
        z-index: 1000;
        animation: slideIn 0.3s ease;
    `;
    
    document.body.appendChild(toast);
    
    setTimeout(() => {
        toast.remove();
    }, 3000);
}
</script>
{% endblock %}